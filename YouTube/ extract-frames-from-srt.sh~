#!/bin/bash

VIDEO="glyph-miner.mp4"
SUBTITLES="glyph-miner.srt"
OUTDIR="frames"

mkdir -p "$OUTDIR"

INDEX=1

# Extract lines with timestamps
grep --line-buffered -E '^[0-9]{2}:[0-9]{2}:[0-9]{2},[0-9]{3}' "$SUBTITLES" | while read -r line
do
    # Extract only the start timestamp (e.g., 00:01:23,456)
    START=$(echo "$line" | cut -d' ' -f1)

    # Convert to ffmpeg format: 00:01:23.456
    FFMPEG_TIME=${START/,/.}

    # Format index with leading zeros
    PADDED_INDEX=$(printf "%03d" "$INDEX")

    # Extract frame using ffmpeg
    ffmpeg -loglevel error -ss "$FFMPEG_TIME" -i "$VIDEO" -frames:v 1 "$OUTDIR/frame${PADDED_INDEX}.png"

    INDEX=$((INDEX + 1))
done

echo "âœ… Done! Extracted $((INDEX - 1)) frames to '$OUTDIR/'"
